<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Data Science :: Cloud Native Robotz Hackathon</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/modules/stable/data-science.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="development.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank">
        <img src="../../_/img/rhdp-logo.svg" height="35px" alt="Red Hat Demo Platform">
      </a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/course-template">Cloud Native Robotz Hackathon</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://redhat.service-now.com/help?id=sc_cat_item&sys_id=00c0316a1bf39450e43942a7bc4bcbd1">Open Support Case</a>
            <a class="navbar-item" target="_blank" href="https://rhdp.statuspage.io/">Status Page</a>
            <a class="navbar-item" target="_blank" href="https://demo.redhat.com/support">Solution Support: Service Level</a>
            <a class="navbar-item" target="_blank" href="https://content.redhat.com/us/en/product/cross-portfolio-initiatives/rhdp.html">Learn more</a>
            <a class="navbar-item" target="_blank" href="https://videos.learning.redhat.com/channel/RHPDS%2B-%2BRed%2BHat%2BProduct%2Band%2BPortfolio%2BDemo%2BSystem/277722533">How to videos</a>
          </div>
        </div>
        <a class="navbar-item" target="_blank" href="https://docs.google.com/forms/d/e/1FAIpQLSfwGW7ql2lDfaLDpg4Bgj_puFEVsM0El6-Nz8fyH48RnGLDrA/viewform">Feedback</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="stable">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Lab guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="data-science.html">0. Data Science</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="development.html">1. Development</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="integration.html">2. Integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="edge-devops.html">3. Edge DevOps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="final-run.html">4. Final Run</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lab guide</span>
    <span class="version">stable</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Lab guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">stable</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Lab guide</a></li>
    <li><a href="data-science.html">0. Data Science</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/cloud-native-robotz-hackathon/lab-guide/edit/main/content/modules/ROOT/pages/data-science.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Data Science</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As Data Scientist our task will be to give our robot understanding of what a red fedora looks like and how to identify one. You will train an existing object dection model (Yolo) on a set of images depicting fedoras. To achieve this we will use <strong>OpenShift AI</strong>, an extension to OpenShift that provides a platform for Data Scientist to work with the tools they are used to.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instantiate_workbench"><a class="anchor" href="#_instantiate_workbench"></a>Instantiate Workbench</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s login into <strong>OpenShift AI</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into the <a href="https://console-openshift-console.apps.example.com" target="_blank" rel="noopener">OpenShift Console</a> with:</p>
<div class="ulist">
<ul>
<li>
<p>username: team-1</p>
</li>
<li>
<p>password : secret-password</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click on the top right menu with the squares and select <strong>OpenShift AI</strong> to access the <strong>OpenShift AI Dashboard</strong></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/rhoai-menu.png" alt="rhoai menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Login with OpenShift</strong></p>
</li>
<li>
<p>Login with the same credentials as before</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The is the main Console where all DataScience related projects and assets are managed</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the left menu click on <strong>Data Science Projects</strong> to see all available Data Science Projects</p>
</li>
<li>
<p>A project has already been prepared for you to work in</p>
</li>
<li>
<p>Click on the project <code>team-1-ai</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a true DataScientist we want to use JuypterLab to work on our prediction model. Let&#8217;s create a new JupyterLab Workbench in our project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Create Workbench</strong></p>
</li>
<li>
<p>Enter these fields :</p>
<div class="ulist">
<ul>
<li>
<p>Name :</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">fedora-detection</code></pre>
</div>
</div>
</li>
<li>
<p>Image selection: <code>Object Detection</code></p>
</li>
<li>
<p>Cluster storage</p>
<div class="ulist">
<ul>
<li>
<p>Create new persistent storage:</p>
<div class="ulist">
<ul>
<li>
<p>Name : <code>fedora-detection</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Data connections</p>
<div class="ulist">
<ul>
<li>
<p>Use a data connection</p>
<div class="ulist">
<ul>
<li>
<p>Use existing data connection: <code>workbench-bucket</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Create Workbench</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wait until the <strong>Status</strong> of the Workbench is shown as running</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workbench-running.png" alt="workbench running">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the <strong>Open</strong> link, next to the <code>fedora-detection</code> Workbench to open the JuypterLab Workbench</p>
</li>
<li>
<p>Login with you OpenShift credentials and allow selected permissions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In JuypterLab we are going to clone some JuypterNotebooks to get started with our ObjectDetection project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the menu on the left, click on the <strong>Git</strong> icon</p>
</li>
<li>
<p>Click on <strong>Clone a Repository</strong></p>
</li>
<li>
<p>Enter the Git Url to the notebooks Repo that has been prepared for you :</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://gitea.apps.example.com/team-1/object-detection-notebooks.git</code></pre>
</div>
</div>
</li>
<li>
<p>Click on <strong>Clone</strong></p>
</li>
<li>
<p>On the left side in the menu click on the <strong>Folder</strong> icon and navigate to <code>object-detection-notebooks</code> directory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next we will train a model on the basis of a Yolo4 Image Detection model to identify fedoras by giving it sample images. The whole training process will run in a Pipeline leveraging OpenShift ressource scaling. Sample images will be downloaded automatically and after the training the model will be exported in onnx format to your S3 ODF store. In this format we can deploy it to an inferencing service of <strong>OpenShift AI</strong> and serve it to our application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In JupyterLab navigate to the directory <code>object-detection-notebooks/model-training</code></p>
<div class="ulist">
<ul>
<li>
<p>Open <code>model-training-cpu.pipeline</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have a look at the pipeline steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We are downloading a set of sample images with labels and coordinates for our classes from the <a href="https://storage.googleapis.com/openimages/web/index.html" target="_blank" rel="noopener">OpenImages website</a>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-images.png" alt="open images">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Preparing the class labels and training sets</p>
</li>
<li>
<p>Running the actual training on a Yolo 5 Model</p>
</li>
<li>
<p>Converting the model format to onnx and then uploading it to an ODF S3 bucket</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The pipeline can be configured to download and train on specifc image object classes (e.g. Fedoras). To configure these classes open the file <code>configuration.yaml</code>. You will see some classes have already been set ('Laptop', 'Computer keyboard', 'Table'). We will change these to detect the objects we are looking for.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the <code>names</code> array to look like this</p>
</li>
</ul>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">names: ['Fedora', 'Ball', 'Tennis ball',]</code></pre>
</div>
</div>
<div class="paragraph">
<p>These image classes are mapped to the class numbers 0, 1, 2 accordingly, press Ctrl-s to save your changes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Now back in the <code>model-training-pipeline</code>, on the top menu on the left click on the play icon</p>
<div class="imageblock">
<div class="content">
<img src="_images/start-pipeline.png" alt="start pipeline">
</div>
</div>
</li>
<li>
<p>Keep the default settings and click on <strong>OK</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This will submit the pipeline to OpenShift to run the training</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Switch to the <strong>OpenShift AI</strong> tab in your browser</p>
</li>
<li>
<p>Select your Data Science Project team-1-ai</p>
</li>
<li>
<p>Select <strong>Pipelines</strong> tab</p>
</li>
<li>
<p>Expand the <strong>model-training-cpu</strong> Pipeline</p>
</li>
<li>
<p>Click on the three dots at the end of line</p>
</li>
<li>
<p>Click on <strong>View runs</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/view-runs.png" alt="view runs">
</div>
</div>
</li>
<li>
<p>Click on <strong>model-training-cpu-xxxxx</strong> at the Run column</p>
<div class="imageblock">
<div class="content">
<img src="_images/view-runs2.png" alt="view runs2">
</div>
</div>
</li>
<li>
<p>Click on the currently running pipeline</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This will show the running steps of the pipeline</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/running-pipeline.png" alt="running pipeline">
</div>
</div>
<div class="paragraph">
<p>Now is a good time to grab some coffee.</p>
</div>
<div class="paragraph">
<p>Once the pipeline has run successfully the final model named <code>latest-version.onnx</code> will be saved in your S3 bucket.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_model_serving"><a class="anchor" href="#_model_serving"></a>Model Serving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You now have a trained model for object recognition. To use the model we will deploy it into <strong>OpenShift AI</strong> Model Serving, which will make it available via an API.</p>
</div>
<div class="sect2">
<h3 id="_model_runtime"><a class="anchor" href="#_model_runtime"></a>Model Runtime</h3>
<div class="paragraph">
<p>First we need to configue a model server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>DataScience Projects</strong> in the main menu on the left and make sure you have selected your project again</p>
</li>
<li>
<p>Select your Data Science Project team-1-ai</p>
</li>
<li>
<p>Under the section <strong>Serve models</strong> click on <strong>Add model server</strong></p>
</li>
<li>
<p>Model server name :</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ovms</code></pre>
</div>
</div>
</li>
<li>
<p>Serving runtime : <code>OpenVINO Model Server</code></p>
</li>
<li>
<p>Make deployed models available &#8230;&#8203; : <code>Check</code></p>
</li>
<li>
<p>Require token authentication : <code>Check</code></p>
<div class="ulist">
<ul>
<li>
<p>Service account name : <code>default-name</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Keep the rest of the settings as is</p>
</li>
<li>
<p>Click <strong>Add</strong></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/serving-runtime.png" alt="serving runtime">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_model"><a class="anchor" href="#_deploy_model"></a>Deploy Model</h3>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Go to Models</strong> next to your just created model server</p>
</li>
<li>
<p>Click <strong>Deploy model</strong></p>
</li>
<li>
<p>In the form enter</p>
<div class="ulist">
<ul>
<li>
<p>Model Name:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">fedora-detection-service</code></pre>
</div>
</div>
</li>
<li>
<p>Model framework (name-version): <code>onnx-1</code></p>
</li>
<li>
<p>Existing data connection: <code>workbench-bucket</code></p>
</li>
<li>
<p>Path:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">models/model-latest.onnx</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Deploy</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wait for the server to start</p>
</div>
</div>
<div class="sect2">
<h3 id="_model_testing"><a class="anchor" href="#_model_testing"></a>Model Testing</h3>
<div class="ulist">
<ul>
<li>
<p>Copy the inference endpoint URL that is published through an OpenShift Route</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/copy-inference-url.png" alt="copy inference url">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the token of the endpoint</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/copy-token.png" alt="copy token">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Back in your JupyterLab Workbench in the <code>object-detection-notebooks</code> directory, open the <code>online-scoring.ipynb</code> notebook</p>
</li>
<li>
<p>Look for the variables <code>prediction_url</code> and <code>token</code> and paste the inference endpoint URL and the token into the placeholders</p>
</li>
<li>
<p>Run the full notebook (The button with the two play icons in the top menu)</p>
</li>
<li>
<p>Confirm to <strong>Restart the Kernel</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see any identified classes with bounding boxes and confidence score. Bummer! As the sample image doesn&#8217;t have any fedoras you will not see any detections yet. Let&#8217;s give our more model some more interesting pictures.</p>
</div>
<div class="paragraph">
<p>You can test your model with different images in the <code>sample-images</code> folder. But even better you can upload your own images. Take some pictures with your laptop or smartphone of a fedora on the floor and upload them into the <code>sample_images</code> folder.  Make sure you adjust the image name in <code>image_path</code> variable before running the notebook again. You should see awesome some detections now.</p>
</div>
<div class="paragraph">
<p>Perhaps you would to like to tweak and increase the detection quality of your model. You can rerun the Pipeline and increase the Sample Size (Number of Images used for training) and epochs (Number of training iterations).</p>
</div>
<div class="paragraph">
<p>Finally it is time to handoff your amazing AI Fedora Detection service to the dev team. Make a note and use the two values <code>prediction_url</code> and <code>token</code> in your app in the next chapter.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html" class="query-params-link">Lab guide</a></span>
  <span class="next"><a href="development.html" class="query-params-link">1. Development</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
