<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploy Control App to the Robot! :: Cloud Native Robotz Hackathon</title>
    <link rel="canonical" href="https://cloud-native-robotz-hackathon.github.io/modules/stable/auto-robot.html">
    <link rel="prev" href="improve-app2.html">
    <link rel="next" href="challenge-2.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <img src="../../_/img/robot.png" />
      <h1>&nbsp;&nbsp;Cloud Native Robotz Hackathon</h1>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" target="_blank" href="https://github.com/cloud-native-robotz-hackathon/infrastructure/issues/new">Feedback</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="stable">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Lab guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="data-science.html">0. Data Science</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="control-robot.html">1. Control your Robot</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="develop-controlapp.html">2. Develop Control Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="improve-app1.html">3. Improve Control App Part 1</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="improve-app2.html">4. Improve Control App Part 2</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="auto-robot.html">5. The Autonomous Robot: Compete!</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="challenge-2.html">6. Final Challenge</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lab guide</span>
    <span class="version">stable</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Lab guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">stable</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Lab guide</a></li>
    <li><a href="auto-robot.html">5. The Autonomous Robot: Compete!</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/cloud-native-robotz-hackathon/lab-guide/edit/main/content/modules/ROOT/pages/auto-robot.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Deploy Control App to the Robot!</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>After your control application performs well enough, it&#8217;s time to move on to the final stage of the hackathon: Have the robot run autonomously and measure the time it takes to accomplish the mission laid out in the final challenge!</p>
</div>
<div class="paragraph">
<p>Testing our solution from OpenShift DevSpaces is fun, but what we really want is an <strong>autonomous robot</strong> that can think for itself and find our fedora in the most disconnected of places. This means the controll app and the object detection service have to run disconnected on the robot</p>
</div>
<div class="paragraph">
<p>You will have to provide your solution assets in the form of container images. It is time to move these onto the robot itself.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/edge-devops/architecture.png" alt="architecture">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_a_container_image_of_the_object_detection_model"><a class="anchor" href="#_build_a_container_image_of_the_object_detection_model"></a>Build a Container Image of the Object Detection Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once we are finished with tuning our object detection model we will package it into a container image to be deployed on the robot.</p>
</div>
<div class="paragraph">
<p>An OpenShift pipeline based on Tekton has been prepared for you</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into the <a href="https://console-openshift-console.apps.example.com" target="_blank" rel="noopener">OpenShift Console</a> with username: team-1 and password : secret-password</p>
</li>
<li>
<p>Go to the the project team-1-ai</p>
</li>
<li>
<p>Click <strong>Pipelines</strong> on the left</p>
</li>
<li>
<p>Click on the Pipeline <code>model-image-build</code></p>
</li>
<li>
<p>Click on Actions &#8594; Start</p>
<div class="imageblock">
<div class="content">
<img src="_images/edge-devops/start-pipeline.png" alt="start pipeline">
</div>
</div>
</li>
<li>
<p>Click on Start to start the pipeline</p>
<div class="imageblock">
<div class="content">
<img src="_images/edge-devops/start-pipeline-2.png" alt="start pipeline 2" width="700px">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_a_container_image_of_the_application"><a class="anchor" href="#_build_a_container_image_of_the_application"></a>Build a Container Image of the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When done with the app we will package it in a Container Image as well.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Make sure you have pushed the latest version of your app into Gitea!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A matching pipeline has been added to your template app repository. This pipeline is triggered by the creation of a Tag in Gitea. So once you are ready, all you need to do is create a Tag and the Pipeline will build and push the Image to the local OpenShift Registry.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Login into <a href="https://gitea.apps.example.com/team-1/starter-app-python" target="_blank" rel="noopener">Gitea</a> with</p>
<div class="ulist">
<ul>
<li>
<p>username:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">team-1</code></pre>
</div>
</div>
</li>
<li>
<p>password :</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">secret-password</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Select the repository <code>starter-app-python</code></p>
</li>
<li>
<p>Click on <strong>Releases</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/gitea-release.png" alt="gitea release">
</div>
</div>
</li>
<li>
<p>Click on <strong>New Release</strong></p>
</li>
<li>
<p>Enter the <strong>Tag name</strong>:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">v1</code></pre>
</div>
</div>
</li>
<li>
<p>Click on the button <strong>Create Tag Only</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now please open <a href="https://console-openshift-console.apps.example.com/pipelines/ns/team-1-dev/pipeline-runs" target="_blank" rel="noopener">OpenShift Console</a>.
You should see you Pipeline running.</p>
</div>
<details>
<summary class="title">If not please, follow:</summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Make sure you are in the <strong>Project</strong> <code>team-1-dev</code></p>
</li>
<li>
<p>Click in the Menu in the left: <strong>Pipelines</strong> &#8594; <strong>Pipelines</strong></p>
<div class="ulist">
<ul>
<li>
<p>And the Tab <strong>PipelineRuns</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</details>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_you_images_to_the_robot_with_gitops"><a class="anchor" href="#_deploy_you_images_to_the_robot_with_gitops"></a>Deploy you Images to the Robot with GitOps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have the images we can deploy them to the robot.  Since the robots are running Microshift (a lightweight version of OpenShift) we can use consistent tooling to automate our Deployment. We will use <strong>OpenShift GitOps</strong> based on ArgoCD for this.</p>
</div>
<div class="paragraph">
<p>A <strong>OpenShift GitOps</strong> project has already been setup that listens to changes of a configuration repository. The microshift of your robot as been added as manged cluster so any change in the repo will be rolled out diretcly to your robot. All you need to do is update the configuration code in Gitea.</p>
</div>
<div class="paragraph">
<p>Have a look at the Git repo : <a href="https://gitea.apps.example.com/team-1/robot-gitops" target="_blank" rel="noopener">robot-gitops</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The object detection image needs to be set here:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://gitea.apps.example.com/team-1/robot-gitops/src/branch/main/base/namespace/triton/deployment.yaml" target="_blank" rel="noopener">robot-gitops/src/branch/main/base/namespace/triton/deployment.yaml</a></p>
<div class="ulist">
<ul>
<li>
<p>Click on the pen icon on the top right to edit the file</p>
</li>
<li>
<p>In the resource yaml look for the field <code>image:</code> with the value</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">quay.io/cloud-native-robotz-hackathon/model-container:trained</code></pre>
</div>
</div>
</li>
<li>
<p>Replace the value with</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">default-route-openshift-image-registry.apps.example.com/team-1-ai/model-container:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Click on the <strong>Commit Changes</strong> Button at the very bottom</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The app image needs to be set here:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://gitea.apps.example.com/team-1/robot-gitops/src/branch/main/base/namespace/robot-app/deployment.yaml" target="_blank" rel="noopener">robot-gitops/src/branch/main/base/namespace/robot-app/deployment.yaml</a></p>
<div class="ulist">
<ul>
<li>
<p>Click on the pen icon on the top right to edit the file</p>
</li>
<li>
<p>In the resource yaml look for the field <code>image</code> with the value</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">quay.io/cloud-native-robotz-hackathon/starter-app-python:master</code></pre>
</div>
</div>
</li>
<li>
<p>Replace the value with</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">default-route-openshift-image-registry.apps.example.com/team-1-dev/starter-app-python:v1</code></pre>
</div>
</div>
</li>
<li>
<p>Click on the <strong>Commit Changes</strong> Button at the very bottom</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In real world projects, you would use a tool such as <strong>Kustomize</strong> to add modification layer without changing the actual deployment.yaml files
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you commit the changes <strong>OpenShift GitOps</strong> will start to work on the deployment.</p>
</div>
<div class="sect2">
<h3 id="_check_openshift_gitops_argocd_rollout"><a class="anchor" href="#_check_openshift_gitops_argocd_rollout"></a>Check OpenShift GitOps / ArgoCD rollout</h3>
<div class="paragraph">
<p>Login into OpenShift GitOps / ArgoCD:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open: <a href="https://openshift-gitops-server-openshift-gitops.apps.example.com" target="_blank" rel="noopener">OpenShift GitOps/ArgoCD</a></p>
</li>
<li>
<p>Click <strong>"LOG IN VIA OPENSHIFT"</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/argocd-login.png" alt="argocd login" width="450px">
</div>
</div>
</li>
<li>
<p>Username:</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">team-1</code></pre>
</div>
</div>
</li>
<li>
<p>Password :</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">secret-password</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Allow selected permissions</strong></p>
</li>
<li>
<p>Now you can follow the rollout, this is the entry view:</p>
<div class="imageblock">
<div class="content">
<img src="_images/argocd-overview.png" alt="argocd overview" width="600px">
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you click the tile, you&#8217;ll get a detailed view of your GitOps rollout:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/argocd-detail.png" alt="argocd detail" width="600px">
</div>
</div>
<div class="paragraph">
<p><strong>But the outcome is clear</strong>: The control application and the image detection model are running as containers locally on your robot, enabling autonomous robot operations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_the_robot"><a class="anchor" href="#_start_the_robot"></a>Start the Robot</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As the app is now running locally on the robot, you won&#8217;t get access to the web UI of the app. It&#8217;s an edge device after all&#8230;&#8203; ;-)</p>
</div>
<div class="paragraph">
<p>But we need a way to call <strong>Initiate Run</strong> and <strong>Emergency Stop</strong> like you did before from the web UI. Here good old <code>curl</code> comes to the rescue.</p>
</div>
<div class="paragraph">
<p>To start the robot, go to your Dev Spaces VSCode session and open a terminal. In the terminal execute the following command to initiate a run:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ROBOT_NAME=gort

curl -X POST -H "Host: starterapp-python-robot-app.apps.${ROBOT_NAME}" http://${ROBOT_NAME}.robot.svc.cluster.local:80/run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your robot should now execute your code and start moving. If you want to check the output of your control app, you can do this in OpenShift GitOps. Go to your ArgoCD UI again and click the box representing your app (<code>starterapp-python-&#8230;&#8203;.</code>) to the left. In the next view choose the <strong>LOGS</strong> tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/argocd-app.png" alt="argocd app" width="600px">
</div>
</div>
<div class="paragraph">
<p>After a short delay the output of your app will show up in the window, same as what you are used to from developing the app in Dev Spaces:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/argocd-logs.png" alt="argocd logs" width="600px">
</div>
</div>
<div class="paragraph">
<p>To stop your robot you can call the stop endpoint in the same way as you just run it:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ROBOT_NAME=gort

curl -X POST -H "Host: starterapp-python-robot-app.apps.${ROBOT_NAME}" http://${ROBOT_NAME}.robot.svc.cluster.local:80/stop</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_expected_outcome_of_this_chapter"><a class="anchor" href="#_expected_outcome_of_this_chapter"></a>Expected outcome of this chapter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have configured a GitOps process to deploy your app to the robot</p>
</li>
<li>
<p>Your robot is now able to run autonomously</p>
</li>
<li>
<p>You know how to start and stop the robot using a <code>curl</code> call</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If anything is unclear about these points, please talk to your friendly facilitators.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now off to the final, go to the next chapter to learn how to prove your robots capabilities in front of your peers!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="improve-app2.html" class="query-params-link">4. Improve Control App Part 2</a></span>
  <span class="next"><a href="challenge-2.html" class="query-params-link">6. Final Challenge</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
