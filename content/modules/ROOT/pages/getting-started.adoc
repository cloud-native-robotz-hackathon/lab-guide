= Getting Started

Here are the steps you will to go through in order to work on the robot challenges:

* Setup the coding environment
* Clone example code
* Connect the application to your robot (the robot will be assigned by the challenge facilitators)
* Connect to the OpenShift AI Model Server

[NOTE]
====
You need the inferencing API and access token you created in the OpenShift AI challenge to work on the robot vision challenge!
====

== Access the Environment

[NOTE]
====
Most of the applications you are about to use are enabled for Single Sign-On using **Red Hat Build of Keycloak**. So when you first access the OpenShift Console, you'll be directed to Keycloak for authentication.
====

* Login into the {openshift_console_url}[OpenShift Console,window=_blank] with:
** username:
+
[source,text,role=execute,subs="attributes"]
----
{user}
----
** password :
+
[source,text,role=execute,subs="attributes"]
----
{password}
----

After you have authenticated you'll get to the OpenShift Console.

* Click *Skip tour* if prompted

== Set Up Your Development Environment

To develop your robot control code, we will use **OpenShift Dev Spaces**, a web IDE that comes with every OpenShift installation. No need to setup IDEs, runtimes and tools on your laptop.

* In the OpenShift Console on the top right, click on the square icon and select **Red Hat OpenShift Dev Spaces**
* Click **Login with OpenShift**
* Give permissions if required

=== Create Your Workspace

We'll initialize a workspace using a https://devfile.io/[DevFile] that defines the environment, tooling, and runtimes.

* Select **Create Workspace** in the left menu
* Enter **Git Repo URL** :
+
[source,bash,role=execute,subs="attributes"]
----
{gitea_console_url}/{user}/starter-app-python/raw/branch/master/devfile.yaml
----

* Click on **Create and Open**

image::devspaces-create-workspace.png[]

Wait for the Workspace to deploy (this may take a minute or two). Once your Workspace is up and running, you should see a view that looks familiar if you have used VSCode before.

* If you see a Popup asking you to "Do you trust the authors", click check **Always ...**  and click **Yes ...**

image::vscode-trust.png[]

=== Clone the Starter Code

* On the left side click on the button **Clone Repository**
* In the form at the top enter the git url
+
[source,bash,role=execute,subs="attributes"]
----
{gitea_console_url}/{user}/starter-app-python.git
----
* Hit **Enter**
* In the next form keep the path as is ( `/projects` ) and hit **Enter** again
* In the next dialog click on the **Open** button to reopen the workspace in this directory

You will now see the starter code on the left side. This is a Python application that is served as a REST API server through the Gunicorn framework.

=== Connecting the App to Robot API Endpoints

Our app will be running in a **Dev Spaces** container. We will need to call the Robot API as well as the Inferencing Server API in OpenShift AI to do our coding magic.

[WARNING]
====
You must have solved the OpenShift AI challenges first so your model server is running. Take the information for the inferencing API and token from there.
====

So let's go ahead and set up these connection variables. Edit the file `config.py` to add your inferencing endpoint that you created in the previous chapter.

Replace the following placeholders:

* **<REPLACE_WITH_ROBOT_NAME>**: **The robot name will be supplied from the robot challenge supporters!**
* **<REPLACE_WITH_INFERENCING_API>**
+
(The Object Detection Service from the OpenShift AI challenge)
* **<REPLACE_WITH_INFERENCING_API_TOKEN>**
+
(The Token of the Object Detection Service from the OpenShift AI challenge)


TIP: Note that **Dev Spaces** saves your file directly while you edit it. No need to save manually. And as an added bonus **Gunicorn** reloads your python app, so there is also no need to restart you app or even reload the Robot control page.

=== Start the Application

* In the top left, click on the "hamburger" menu > **Terminal** > **Run Task ...**
* In the selection menu at the top, click on **devfile**
* Then click on **devfile: Run the application**

This will install the python dependencies and start the server of your app.

=== Open the Robot Control Page

TIP: Once the Python Gunicorn server has started, you will see two Popup windows in the bottom right corner that you will need to approve. These will setup a port forwarding and publish a **Route** in OpenShift.

* Click on **Yes** to allow port forwarding
+
image::devspaces-allow_route.png[]

* Click on **Open in new tab**
+
image::devspaces-open-new-tab.png[]

* Click on **Open**
+
image::devspaces-open-tab.png[]

A new browser tab with the web interface of the Robot Control app will open. Make sure you are on `http://` if the page does not open.

=== If you missed the Popups

.Click here to restart the Control Page
[%collapsible]
====

**If you have missed any of the Popups, you need to end and restart the process:**

* Click on the garbage can icon on the right of the terminal

image::kill-terminal.png[]

* Now restart the Gunicorn server with the task as explained above

If you have missed the second of the Popups (opening the Route), there is another way to open it:

* In the left pane at the bottom expand the **ENDPOINTS** section
* Hover over the entry `user-port-forward(8080)`
* Click in the icon (`Open in new Tab`)
* A tab with the Robot Control App will open in your Browser

image::open-endpoints.png[]

====

image::robot-control-page2.png[]

The Robot Control Page has these buttons:

* **Check Status** - Calls the app to see if the robot is connected
* **Initiate Run** - Calls your `startRobot()` function in the `app.py`. This is where you will add your code
* **Emergency Stop** - Stop execution of your app

Now check if everything is setup correctly:

* On the Robot Control Page click on **Check Status**

You should see a confirmation that your Robot is doing ok. If not, have a look at the console output in your Dev Spaces Workspace and recheck `config.py`.

== The Robot API

The Robot REST API is simple and straightforward. Here are the available endpoints:

* `POST /forward/<length>` - Drive forward by length
* `POST /backward/<length>` - Drive backwards by length
* `POST /left/<degrees>` - Turn left by degrees
* `POST /right/<degrees>` - Turn right by degrees
* `GET /camera` - Returns a base64 image of the current camera image
* `GET /status` - Returns the status of the robot
* `GET /power` - Returns the current power of the robot
* `GET /distance` - Returns the distance to an object in front of the robot (max value is 3000 mm)

== Helper Functions

The starter code provides helper functions to make coding and using the API easier:

* `move_forward(length)` - Drive the robot forward
* `move_backward(length)` - Drive the robot backward
* `turn_left(degrees)` - Turn the robot left
* `turn_right(degrees)` - Turn the robot right
* `take_picture()` - Get a camera image
* `distance()` - Get distance reading from the sensor
* `distance_int()` - Get distance as an integer

== Your Code Location

Your code goes in the `startRobot()` function in `app.py`. Look for the comment `# Drop your code here`.

[source,python]
----
def startRobot():
    # Drop your code here
    move_forward(10)
----

== Testing Your Code

* Write your code in the `startRobot()` function as above
* Click the **Initiate Run** button on the Robot Control Page
* Watch your robot execute your code and move forward!
* Use **Emergency Stop** if you need to stop execution
* If the Gunicorn robot app server crashes for some reason, just restart it via the **Terminal DevFile Task**

== Ready to Code!

You're all set! You now have:

* âœ… Development environment running
* âœ… Robot connection configured
* âœ… Robot Control Page open
* âœ… Understanding of the Robot API

You're ready to tackle the coding challenges! Good luck! ðŸš€

